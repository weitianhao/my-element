{"version":3,"file":"index.mjs","sources":["../../../../../packages/hooks/use-focus-controller/index.ts"],"sourcesContent":["import { getCurrentInstance, ref, shallowRef, watch } from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { isFunction } from '@element-plus/utils'\nimport type { ShallowRef } from 'vue'\n\ninterface UseFocusControllerOptions {\n  afterFocus?: () => void\n  /**\n   * return true to cancel blur\n   * @param event FocusEvent\n   */\n  beforeBlur?: (event: FocusEvent) => boolean | undefined\n  afterBlur?: () => void\n  isFull?: any\n}\n\nexport function useFocusController<T extends HTMLElement>(\n  target: ShallowRef<T | undefined>,\n  { afterFocus, beforeBlur, afterBlur, isFull }: UseFocusControllerOptions = {}\n) {\n  const instance = getCurrentInstance()!\n  const { emit, provides } = instance as any\n  const parentFocus = provides['PARENT_FOCUS']\n  const setFloat = provides['SET_FLOAT']\n  const isFloat = provides['IS_FLOAT']\n  const parentClear = provides['PARENT_CLEAR']\n  const wrapperRef = shallowRef<HTMLElement>()\n  const isFocused = ref(false)\n  if (parentFocus) {\n    watch(parentFocus, (val) => {\n      if (isFloat && isFloat.value && setFloat)\n        setFloat(isFull && isFull.value ? isFull.value : val)\n    })\n  }\n  if (parentClear) {\n    watch(parentClear, () => {\n      isFocused.value = false\n    })\n  }\n  const handleFocus = (event: FocusEvent) => {\n    if (isFocused.value) return\n    isFocused.value = true\n    emit('focus', event)\n    afterFocus?.()\n    if (!parentFocus && isFloat && isFloat.value && setFloat) setFloat(true)\n  }\n\n  const handleBlur = (event: FocusEvent) => {\n    const cancelBlur = isFunction(beforeBlur) ? beforeBlur(event) : false\n    if (\n      cancelBlur ||\n      (event.relatedTarget &&\n        wrapperRef.value?.contains(event.relatedTarget as Node))\n    )\n      return\n\n    isFocused.value = false\n    emit('blur', event)\n    afterBlur?.()\n    if (!parentFocus && isFloat && isFloat.value && setFloat)\n      setFloat(isFull && isFull.value)\n  }\n\n  const handleClick = () => {\n    target.value?.focus()\n  }\n\n  watch(wrapperRef, (el) => {\n    if (el) {\n      el.setAttribute('tabindex', '-1')\n    }\n  })\n\n  // TODO: using useEventListener will fail the test\n  // useEventListener(target, 'focus', handleFocus)\n  // useEventListener(target, 'blur', handleBlur)\n  useEventListener(wrapperRef, 'click', handleClick)\n\n  return {\n    wrapperRef,\n    isFocused,\n    handleFocus,\n    handleBlur,\n  }\n}\n"],"names":[],"mappings":"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"}